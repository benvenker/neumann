#!/usr/bin/env bash
# Automatically activate Python virtual environment when entering this directory

# Use the virtual environment created by uv
source .venv/bin/activate

# Optional: Add project root to PYTHONPATH
export PYTHONPATH="$PWD:$PYTHONPATH"

# Fix WeasyPrint library loading on macOS (Homebrew GObject/GTK dependencies)
export DYLD_FALLBACK_LIBRARY_PATH="/opt/homebrew/lib:${DYLD_FALLBACK_LIBRARY_PATH:-}"

# Load secrets and config from .env if present (direnv stdlib)
# This will override any global exports when entering this directory
dotenv_if_exists .env

# Explicitly ensure OPENAI_API_KEY from .env takes precedence over global exports
# (pydantic-settings checks env vars before .env, so we need to export it here)
if [ -f .env ]; then
  export OPENAI_API_KEY=$(grep "^OPENAI_API_KEY=" .env | cut -d '=' -f2- | tr -d '"' | tr -d "'")
fi
